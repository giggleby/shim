#!/bin/sh
# Copyright (c) 2014 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

MYDIR="$(dirname "$(readlink -f "$0")")"
FACTORY_BASE="/usr/local/factory"

main() {
  # Install console (VT2) customizations
  mount --bind "${MYDIR}/profile.d/vt2.sh" /etc/profile.d/cursor.sh

  for tag_file in ${MYDIR}/tag_*; do
    local tag_script="${MYDIR}/tags.d/start_${tag_file#${MYDIR}/tag_}"
    if [ -x "${tag_script}" ]; then
      "${tag_script}"
    fi
  done

  local tag_presenter="${MYDIR}/run_goofy_presenter"
  local tag_device="${MYDIR}/run_goofy_device"

  if [ -f "${tag_presenter}" -a ! -f "${tag_device}" ]; then
    mount --bind "${MYDIR}/etc/presenter.conf" /etc/chrome_dev.conf
  elif [ ! -f "${tag_presenter}" -a -f "${tag_device}" ]; then
    # Device-only mode.
    true
  else
    # standalone mode.
    mount --bind "${MYDIR}/etc/chrome_dev.conf" /etc/chrome_dev.conf
  fi
}

main "$@"
