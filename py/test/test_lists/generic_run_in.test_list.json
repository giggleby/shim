{
  "inherit": [
    "generic_common.test_list"
  ],
  "constants": {
    "run_in": {
      "sat_duration_secs": 28800,
      "__comment_run_fishes_for_secs": "See tast/local/bundles/cros/graphics/webgl_aquarium.go.",
      "run_fishes_for_secs": 120,
      "dozing_sat_duration_secs": 600,
      "reboot_warmup_secs": 30
    }
  },
  "definitions": {
    "RunIn": {
      "inherit": "TestGroup",
      "label": "Run-In Test",
      "locals": {
        "station_end_upload_report": false,
        "station": "RUNIN"
      },
      "subtests": [
        "RunInStart",
        "Barrier",
        "RunInItems",
        "CheckPoint",
        "RunInEnd"
      ]
    },
    "RunInBlockingCharge": {
      "inherit": "BlockingCharge",
      "__comment": "Charges battery to min_charge_pct from Goofy's charge_manager. There will be no AC power during FATP process, so we must make sure DUT battery has enough charge before leaving RunIn.",
      "args": {
        "timeout_secs": 7200
      }
    },
    "RunInCountdown": {
      "pytest_name": "countdown",
      "__comment": "temp_criteria: A list of rules to check that temperature is under the given range, rule format is [name, temp_index, warning_temp, critical_temp]",
      "args": {
        "log_interval": 10,
        "grace_secs": 480,
        "temp_max_delta": 10,
        "temp_criteria": [
          [
            "CPU",
            null,
            null,
            null
          ]
        ]
      }
    },
    "RunInDozingStress": {
      "label": "Dozing Stress",
      "parallel": true,
      "__comment": "This test runs `stressapptest` and `suspend_stress_test` simultaneously.\n\nIn addition to measure the ability of a device to transition between ACPI power states, `stressapptest` can detect bad memory.",
      "subtests": [
        {
          "inherit": "StressAppTest",
          "args": {
            "seconds": "eval! constants.run_in.dozing_sat_duration_secs",
            "free_memory_only": true
          }
        },
        {
          "inherit": "SuspendStress",
          "args": {
            "cycles": 15,
            "suspend_delay_min_secs": 28,
            "suspend_delay_max_secs": 30,
            "suspend_time_margin_min_secs": -1
          }
        },
        {
          "inherit": "RunInCountdown",
          "args": {
            "duration_secs": "eval! constants.run_in.dozing_sat_duration_secs"
          }
        }
      ]
    },
    "RunInEnd": {
      "inherit": "TestGroup",
      "label": "Finish",
      "subtests": [
        "StationEnd",
        "CheckPoint",
        "RunInRebootStep"
      ]
    },
    "RunInItems": {
      "inherit": "FlattenGroup",
      "__comment": "RunIn is a stage to stress all ports for checking system stability. This stage may have many test barriers to let it fail early and reduce wasted test time.\n\nThe Factory Requirements (https://chromeos.google.com/partner/dlm/docs/factory/factoryrequirements.htm) states that suspend resume is required as an essential part of Run-In testing. The purpose is to measure the ability of a device to transition between ACPI power states. To be more specific, ODM is required to perform RunInDozingStress.",
      "subtests": [
        "TPMVerifyEK",
        "ClearTPMOwnerRequest",
        "RunInMRCCache",
        "RunInRebootStep",
        "Fan",
        "RunInStressGroupWithFrontCamera",
        "Barrier",
        "RunInStressGroupWithRearCamera",
        "Barrier",
        "RunInWebGLAquarium50",
        "Barrier",
        "RunInWebGLAquarium1000",
        "Barrier",
        "RunInRebootStep",
        "Barrier",
        "RunInDozingStress",
        "Barrier",
        "RunInRebootSequence",
        "Barrier",
        "VerifyRootPartition",
        "Barrier",
        "RunInBlockingCharge",
        "Barrier",
        "MemorySize",
        "BatterySysfs"
      ]
    },
    "RunInMRCCache": {
      "label": "i18n! MRC Cache",
      "subtests": [
        {
          "pytest_name": "mrc_cache",
          "label": "i18n! Create Cache",
          "args": {
            "mode": "create"
          }
        },
        "RunInRebootStep",
        {
          "pytest_name": "mrc_cache",
          "label": "i18n! Verify Cache Update",
          "args": {
            "mode": "verify_update"
          }
        },
        "RunInRebootStep",
        {
          "pytest_name": "mrc_cache",
          "label": "i18n! Verify Cache No Update",
          "args": {
            "mode": "verify_no_update"
          }
        }
      ]
    },
    "RunInRebootSequence": {
      "inherit": "RunInRebootStep",
      "iterations": 15
    },
    "RunInRebootStep": {
      "inherit": "RebootStep",
      "args": {
        "warmup_post_shutdown": "eval! constants.run_in.reboot_warmup_secs"
      }
    },
    "RunInStart": {
      "inherit": "TestGroup",
      "label": "Prepare",
      "subtests": [
        "StationStart"
      ]
    },
    "RunInStressAppTest": {
      "inherit": "StressAppTest",
      "args": {
        "seconds": "eval! constants.run_in.sat_duration_secs",
        "wait_secs": 10,
        "free_memory_only": true
      }
    },
    "RunInStressCountdown": {
      "inherit": "RunInCountdown",
      "args": {
        "wifi_update_interval": 10,
        "bluetooth_update_interval": 10,
        "als_update_interval": 10,
        "duration_secs": "eval! constants.run_in.sat_duration_secs"
      }
    },
    "RunInStressFrontCamera": {
      "inherit": "FrontCamera",
      "args": {
        "mode": "timeout",
        "show_image": false,
        "timeout_secs": "eval! constants.run_in.sat_duration_secs"
      }
    },
    "RunInStressGroup": {
      "inherit": "RunInStressGroupWithFrontCamera"
    },
    "RunInStressGroupWithFrontCamera": {
      "label": "Stress Group With Front Camera",
      "parallel": true,
      "subtests": [
        "RunInStressFrontCamera",
        "RunInURandom",
        "RunInStressAppTest",
        "RunInStressCountdown"
      ]
    },
    "RunInStressGroupWithRearCamera": {
      "label": "Stress Group With Rear Camera",
      "run_if": "not constants.has_device_data or device.component.has_rear_camera",
      "parallel": true,
      "subtests": [
        "RunInStressRearCamera",
        "RunInURandom",
        "RunInStressAppTest",
        "RunInStressCountdown"
      ]
    },
    "RunInStressRearCamera": {
      "inherit": "RearCamera",
      "args": {
        "mode": "timeout",
        "show_image": false,
        "timeout_secs": "eval! constants.run_in.sat_duration_secs"
      }
    },
    "RunInURandom": {
      "inherit": "URandom",
      "args": {
        "duration_secs": "eval! constants.run_in.sat_duration_secs"
      }
    },
    "RunInWebGLAquarium": {
      "inherit": "WebGLAquarium",
      "__comment": "You can enhance RunInStressGroup by adding this test. However, running WebGLAquarium with a bunch of other stress tests is not a FSI gate. go/pe-sw-gates",
      "args": {
        "duration_secs": "eval! constants.run_in.sat_duration_secs"
      }
    },
    "RunInWebGLAquarium1000": {
      "inherit": "RunInWebGLAquarium",
      "label": "Webgl Aquarium 1000",
      "__comment": "Monitor the performance of graphics.",
      "args": {
        "duration_secs": "eval! constants.run_in.run_fishes_for_secs",
        "num_fish": 1000
      }
    },
    "RunInWebGLAquarium50": {
      "inherit": "RunInWebGLAquarium",
      "label": "Webgl Aquarium 50",
      "__comment": "Monitor the performance of graphics.",
      "args": {
        "duration_secs": "eval! constants.run_in.run_fishes_for_secs",
        "num_fish": 50
      }
    }
  }
}
