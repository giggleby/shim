---
# Copyright 2014 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.
#
# YAML configuration file for factory software dependency checking rules.
# Read http://crbug.com/403712 for more information.

# 'groups' is a dictionary of "name => packages list" mapping that can be used
#          later in 'rules'.
# 'rules' is a dicionary of "module => imports" mapping that "module" can only
#         import from the packages listed in "imports".  Note '*' in "imports"
#         means no limitation, and a module (or imports) quoted by '<>' refers
#         to a name defined in "groups".

groups:
  top:
   - cros.factory  # Top level of factory name space. Only global hooks
                   # (factory_common, hacked_argparse).
   - cros.factory.utils  # Common shared utilities.
   - jsonrpclib  # Special case - currently installed inside factory repo.
  core:
   - cros.factory.hwdb  # Hardware-ID database.
   - cros.factory.hwid  # Hardware-ID processing.
   - cros.factory.l10n  # Localization data.
   - cros.factory.gooftool  # Google Factory core utility for finalization.
  shared:
   - cros.factory.board  # Board-specific utility functions.
   - cros.factory.system  # OS level utility functions.
   - cros.factory.rma  # RMA-specific features.
  framework:
   - cros.factory.goofy  # Factory test scheduler and controller.
   - cros.factory.test  # Base class for tests controlled by goofy.
   - cros.factory.test.test_lists
   - cros.factory.test.e2e_test
   - cros.factory.diagnosis  # Diagnosis tools, used by Goofy.
  tests:
   - cros.factory.test.utils  # Allow 3rd party / external dependency.
   - cros.factory.test.pytests  # No limitation.
   - cros.factory.test.fixture  # Should be simpler depenency than pytests.
  release:
   - cros.factory.toolkit  # Factory toolkit creation.
   - cros.factory.tools  # Misc tools.
   - cros.factory.factory_flow  # Factory flow automation testing.
   - cros.factory.doc  # Documents (generation).
  projects:
   - cros.factory.proto  # Google Protobuf.
   - cros.factory.umpire
   - cros.factory.lumberjack
   - cros.factory.minijack
   - cros.factory.shopfloor
   - cros.factory.experimental
   - cros.factory.cast
   - cros.factory.rf  # Radio frequency related tests.
  known_deps:  # Well-known external dependencies.
   - dbus
   - _dbus_bindings
   - dpkt
   - jsonrpclib
   - netifaces
   - numpy
   - pexpect
   - PIL
   - setproctitle
   - ws4py
  test_deps:  # Special dependency for cros.factory.test.*_util.
   - cros.factory.proto
   - evdev
   - google
   - google.protobuf
   - logilab
   - pkg_resources
   - pyudev
   - serial
   - cv
   - cv2
  autotest_deps:  # Autotest dependencies within chroot (see
                  # factory/py/test/autotest_common.py).
   - mnt.host.source.src.third_party.autotest.files.cli
   - mnt.host.source.src.third_party.autotest.files.client
   - mnt.host.source.src.third_party.autotest.files.client
   - mnt.host.source.src.third_party.autotest.files.client.bin
   - mnt.host.source.src.third_party.autotest.files.client.common_lib
   - mnt.host.source.src.third_party.autotest.files.database
   - mnt.host.source.src.third_party.autotest.files.frontend
   - mnt.host.source.src.third_party.autotest.files.mirror
   - mnt.host.source.src.third_party.autotest.files.scheduler
   - mnt.host.source.src.third_party.autotest.files.server
   - mnt.host.source.src.third_party.autotest.files.site_utils
   - mnt.host.source.src.third_party.autotest.files.tko
   - mnt.host.source.src.third_party.autotest.files.utils

rules:
  <top>:        [<top>]
  # TODO(hungte) Remove '*' from 'core' and 'shared' when their broken
  # dependency is fixed.
  <core>:       [<top>, <core>, '*']
  <shared>:     [<top>, <core>, <shared>, '*']
  # TODO(hungte) Make test_deps only for cros.factory.test.*_util.
  <framework>:  [<top>, <core>, <shared>, <framework>, <known_deps>,
                 cros.factory.umpire, cros.factory.umpire.client,
                 cros.factory.tools, <test_deps>, <autotest_deps>]
  <tests>:      ['*']
  <projects>:   ['*']
  <release>:    ['*']
