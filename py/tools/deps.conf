---
# Copyright 2014 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.
#
# YAML configuration file for factory software dependency checking rules.
# Read http://crbug.com/403712 for more information.

# 'groups' is a dictionary of "name => packages list" mapping that can be used
#          later in 'rules'.
# 'rules' is a dicionary of "module => imports" mapping that "module" can only
#         import from the packages listed in "imports".  Note '*' in "imports"
#         means no limitation, and a module (or imports) quoted by '<>' refers
#         to a name defined in "groups".

groups:
  top:
   - cros.factory  # Top level of factory name space (only factory_common).
   - cros.factory.external  # Wrapper to external libraries.
   - cros.factory.utils  # Common shared utilities.
   - jsonrpclib  # Special case - currently installed inside factory repo.
   - jsonschema  # Schema library for configuration data.
  test_base:
   # Constants and primitive definitions for factory tests.
   - cros.factory.test.env  # Constants defined for factory tests.
   - cros.factory.test.l10n  # Localization data.
   - cros.factory.test.rules  # Rules related to test (and gooftool, hwid).
  test_cros:
   # ChromeOS specific utilities (may run in command line with minimal
   # dependency.
   - cros.factory.hwid  # ChromeOS hardware idendifier (HWID).
   - cros.factory.hwid.v2  # ChromeOS hardware idendifier (HWID) version 2.
   - cros.factory.hwid.v3  # ChromeOS hardware idendifier (HWID) version 3.
   - cros.factory.gooftool  # Google Factory core utility for finalization.
  gooftool_deps:
   - evdev
  framework:
   - cros.factory.goofy  # Factory test scheduler and controller.
   - cros.factory.device  # Device-Aware API.
   - cros.factory.device.android
   - cros.factory.device.audio  # Audio control for different target.
   - cros.factory.device.boards
   - cros.factory.device.chromeos
   - cros.factory.device.links
   - cros.factory.test  # Base class for tests controlled by goofy.
   - cros.factory.test.diagnosis  # Diagnosis tools, used by Goofy.
   - cros.factory.test.e2e_test
   - cros.factory.test.test_lists
   - cros.factory.test.utils  # Allow 3rd party / external dependency.
  tests:
   - cros.factory.test.pytests  # No limitation.
   - cros.factory.test.fixture  # Should be simpler depenency than pytests.
   - cros.factory.test.rf  # Radio frequency related tests.
  release:
   - cros.factory.doc  # Documents (generation).
   - cros.factory.factory_flow  # Factory flow automation testing.
   - cros.factory.toolkit  # Factory toolkit creation.
   - cros.factory.tools  # Misc tools.
  projects:
   - cros.factory.cast
   - cros.factory.dome
   - cros.factory.experimental
   - cros.factory.lumberjack
   - cros.factory.minijack
   - cros.factory.proto  # Google Protobuf.
   - cros.factory.shopfloor
   - cros.factory.umpire
  known_deps:  # Well-known external dependencies.
   - cros.factory.external._dummy  # Dummy implementation to external libraries.
   - dbus
   - _dbus_glib_bindings  # Pulled by gtk-2.0
   - _dbus_bindings
   - dpkt
   - enum
   - gtk-2.0  # Primarily for device.bluetooth
   - Image
   - jsonrpclib
   - netifaces
   - numpy
   - pexpect
   - PIL
   - setproctitle
   - ws4py
  test_deps:  # Special dependency for cros.factory.test.*_util.
   - cros.factory.proto
   - evdev
   - logilab
   - pkg_resources
   - pyudev
   - serial
   - cv
   - cv2
  hwid_cmdline:  # Hack for extra dependencies in hwid_cmdline.
   - cros.factory.device
   - cros.factory.umpire
   - cros.factory.umpire.client
   - cros.factory.test
   - cros.factory.tools  # For build_board
  protobuf:
   - google
   - google.protobuf
   - cros.factory.proto
  autotest_deps:  # Autotest dependencies within chroot (see
                  # factory/py/test/autotest_common.py).
   - mnt.host.source.src.third_party.autotest.files.cli
   - mnt.host.source.src.third_party.autotest.files.client
   - mnt.host.source.src.third_party.autotest.files.client
   - mnt.host.source.src.third_party.autotest.files.client.bin
   - mnt.host.source.src.third_party.autotest.files.client.common_lib
   - mnt.host.source.src.third_party.autotest.files.database
   - mnt.host.source.src.third_party.autotest.files.frontend
   - mnt.host.source.src.third_party.autotest.files.mirror
   - mnt.host.source.src.third_party.autotest.files.scheduler
   - mnt.host.source.src.third_party.autotest.files.server
   - mnt.host.source.src.third_party.autotest.files.site_utils
   - mnt.host.source.src.third_party.autotest.files.tko
   - mnt.host.source.src.third_party.autotest.files.utils

rules:
  <top>:        [<top>]
  <test_base>:  [<top>, <test_base>, <protobuf>]
  # TODO(hungte) Remove <hwid_cmdline> when broken dependency is fixed.
  <test_cros>:  [<top>, <test_base>, <test_cros>, <protobuf>, <hwid_cmdline>,
                 <gooftool_deps>]
  # TODO(hungte) Make test_deps only for cros.factory.test.*_util.
  <framework>:  [<top>, <test_base>, <test_cros>, <framework>, <known_deps>,
                 cros.factory.umpire, cros.factory.umpire.client,
                 cros.factory.tools, <protobuf>, <test_deps>, <autotest_deps>]
  <tests>:      ['*']
  <projects>:   ['*']
  <release>:    ['*']
