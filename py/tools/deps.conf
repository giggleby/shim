---
# Copyright 2014 The ChromiumOS Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.
#
# YAML configuration file for factory software dependency checking rules.
# Read http://crbug.com/403712 for more information.

# 'groups' is a dictionary of "name => packages list" mapping that can be used
#          later in 'rules'.
# 'rules' is a dicionary of "module => imports" mapping that "module" can only
#         import from the packages listed in "imports".  Note '*' in "imports"
#         means no limitation, and a module (or imports) quoted by '<>' refers
#         to a name defined in "groups".

groups:
  top:
    - cros.factory  # Top level of factory name space (only __init__.py).
    - cros.factory.utils  # Common shared utilities.
    - =cros.factory.device.device_types
    - =cros.factory.device.device_utils
    # Top level of external namespace (only __init__.py).
    - cros.factory.external
    - httplib2
    - jsonrpclib  # Special case - currently installed inside factory repo.
    - yaml
    - jsonschema
  protobuf:
    - cros.factory.proto
  external_py_lib:
    - cros.factory.external.py_lib.*  # Wrapper to external python libraries.
  chromeos_cli:
    # Wrappers of chromeos command line tools
    - cros.factory.external.chromeos_cli.*
  test_base:
    # Constants and primitive definitions for factory tests.
    - =cros.factory.test.device_data_constants
    - cros.factory.test.env  # Constants defined for factory tests.
    - cros.factory.test.i18n  # Internationalization helpers.
    - =cros.factory.test.i18n  # Internationalization helpers.
    - cros.factory.test.l10n  # Localization data.
    - cros.factory.test.rules  # Rules related to test (and gooftool, hwid).
    - =cros.factory.test.session
  test_log:
    - cros.factory.testlog.*
    - =cros.factory.test.event_log
  test_utils:
    - chromiumos.config.payload
    - =cros.factory.test.device_data
    - =cros.factory.test.event  # Used by device_data.
    - cros.factory.test.utils  # Allow 3rd party / external dependency.
    - =cros.factory.test.state
    - google.protobuf
  test_cros:
    # ChromeOS specific utilities (may run in command line with minimal
    # dependency.
    - cros.factory.hwid  # ChromeOS hardware idendifier (HWID).
    - cros.factory.hwid.v2  # ChromeOS hardware idendifier (HWID) version 2.
    - cros.factory.hwid.v3  # ChromeOS hardware idendifier (HWID) version 3.
    - cros.factory.gooftool.*  # Google Factory core utility for finalization.
    - cros.factory.probe.*
  framework:
    - cros.factory.goofy.*  # Factory test scheduler and controller.
    - cros.factory.device.*  # Device-Aware API.
    - cros.factory.log_extractor.*
    - cros.factory.test  # Base class for tests controlled by goofy.
    - cros.factory.test.diagnosis  # Diagnosis tools, used by Goofy.
    - cros.factory.test.test_lists
    - =cros.factory.test.utils.model_sku_utils
    - =cros.factory.test.utils.smart_amp_utils # Use gooftool.cros_config
    - =cros.factory.test.utils.update_utils
    - cros.factory.umpire
    - cros.factory.umpire.client
    - cros.factory.tools.*
    - cros.factory.hwid.service
  tests:
    - cros.factory.test.pytests.*  # No limitation.
    - cros.factory.test.fixture.*  # Should be simpler depenency than pytests.
    - cros.factory.test.rf.*  # Radio frequency related tests.
  unittests:
    - cros.factory.cli.testdata.scripts.*  # Scripts for unittest only.
    - cros.factory.unittest_utils  # Utility for unittest only.
    - cros.factory.tools.unittest_tools.*
    - =cros.factory.tools.run_unittests
  release:
    - cros.factory.cli  # Exported commands.
    - cros.factory.doc  # Documents (generation).
    - cros.factory.toolkit  # Factory toolkit creation.
  projects:
    - cros.factory.bundle_creator.*
    - cros.factory.dkps.*
    - cros.factory.dome.*
    - cros.factory.experimental.*
    - cros.factory.hwid.service.appengine.*
    - cros.factory.hwid.service.appengine2.*
    - cros.factory.instalog.*
    - cros.factory.multicast.*
    - cros.factory.probe_info_service.*
    - cros.factory.shopfloor
    - cros.factory.test_list_editor.*
    - cros.factory.testlog
    - cros.factory.umpire.server.*
    - cros.factory.umpire_sync.*
  hwid_extractor:
    - cros.factory.hwid_extractor.*
  hwid_extractor_utils:
    # These files should be sync with the "UTILS_SOURCES" in
    # "py/hwid_extractor/Makefile".
    - =cros.factory.utils.file_utils
    - =cros.factory.utils.json_utils
    - =cros.factory.utils.platform_utils
    - =cros.factory.utils.process_utils
    - =cros.factory.utils.schema
    - =cros.factory.utils.sync_utils
    - =cros.factory.utils.thread_utils
    - =cros.factory.utils.time_utils
    - =cros.factory.utils.type_utils
  known_deps:
    - PIL
    - cairo
    - pango
    - pangocairo
    - setproctitle
    - serial
    - ws4py.*
    - qrcode

rules:
  <top>:        [<top>]
  <external_py_lib>:   []
  <chromeos_cli>:  [<top>, <chromeos_cli>]
  <protobuf> :  [google.protobuf.*]
  <test_base>:  [<top>, <protobuf>, <test_base>]
  <test_log> :  [<top>, <test_base>, <test_log>]
  <test_utils>: [<top>, <external_py_lib>, <test_base>, <test_utils>,
                 =cros.factory.test.pytests]
  <test_cros>:  [<top>, <external_py_lib>, <protobuf>, <test_base>, <test_log>,
                 <test_utils>, <test_cros>, <chromeos_cli>]
  <framework>:  [<top>, <external_py_lib>, <protobuf>, <test_base>, <test_log>,
                 <test_cros>, <test_utils>, <framework>, <known_deps>,
                 <chromeos_cli>]
  <tests>:      ['*']
  <projects>:   ['*']
  <release>:    ['*']
  <unittests>:  ['*']
  <hwid_extractor>: [<hwid_extractor_utils>, <hwid_extractor>, <known_deps>]
  <hwid_extractor_utils>: [<hwid_extractor_utils>]
